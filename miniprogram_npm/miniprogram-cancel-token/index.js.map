{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/**\r\n * 为异步Promise和async/await 提供取消接口\r\n * @example `const cts = CancleToken.source(); cts.cancle()`\r\n */\r\nvar CancelToken = /** @class */ (function () {\r\n    /**\r\n     * 生成CancelToken\r\n     * @param executor - callback\r\n     */\r\n    function CancelToken(executor) {\r\n        var _this = this;\r\n        var resolve;\r\n        // tslint:disable-next-line:promise-must-complete\r\n        this.promise = new Promise(function (res) { resolve = res; });\r\n        executor(function (reason) {\r\n            if (_this.reason === undefined) { // 防止重复执行\r\n                _this.reason = reason === undefined ? 'abort' : reason;\r\n                resolve({ errMsg: _this.reason, cancel: true });\r\n            }\r\n        });\r\n    }\r\n    /**\r\n     * Create TokenSoure\r\n     * @returns 生成一个CancelTokenSource\r\n     */\r\n    CancelToken.source = function () {\r\n        var cancel;\r\n        var token = new CancelToken(function (c) {\r\n            cancel = c;\r\n        });\r\n        ///@ts-ignore\r\n        return { token: token, cancel: cancel };\r\n    };\r\n    /**\r\n     * 是否已取消\r\n     */\r\n    CancelToken.prototype.isCancelled = function () {\r\n        return this.reason !== undefined;\r\n    };\r\n    /**\r\n     * 如果已取消，抛出异常\r\n     * 防止二次取消\r\n     * @throws { errMsg: string }\r\n     */\r\n    CancelToken.prototype.throwIfRequested = function () {\r\n        if (this.reason !== undefined) {\r\n            throw typeof this.reason === 'string' ? { errMsg: this.reason, cancel: true, source: CancelToken.name } : this.reason;\r\n        }\r\n    };\r\n    return CancelToken;\r\n}());\r\nexports.CancelToken = CancelToken;\r\n//# sourceMappingURL=index.js.map"]}